spec:
  steps:
  - exec:
      command: sh
      args:
        - "-c"
        - "'kubectl get managed -o yaml > backup/managed-resources.yaml'"
    name: backup-managed-resources
    manualExecution:
      - "sh -c 'kubectl get managed -o yaml > backup/managed-resources.yaml'"
    type: Exec

  - exec:
      command: sh
      args:
        - "-c"
        - "'kubectl get composite -o yaml > backup/composite-resources.yaml'"
    name: backup-composite-resources
    manualExecution:
      - "sh -c 'kubectl get composite -o yaml > backup/composite-resources.yaml'"
    type: Exec

  - exec:
      command: sh
      args:
        - "-c"
        - "'kubectl get claim --all-namespaces -o yaml > backup/claim-resources.yaml'"
    name: backup-claim-resources
    manualExecution:
      - "sh -c 'kubectl get claim --all-namespaces -o yaml > backup/claim-resources.yaml'"
    type: Exec

  - patch:
      type: merge
      files:
      - edit-configuration-metadata/platform-ref-aws.configurations.meta.pkg.crossplane.io_v1alpha1.yaml
    name: edit-configuration-metadata
    manualExecution:
      - "kubectl patch configurations.meta.pkg.crossplane.io platform-ref-aws --type='merge' --patch-file edit-configuration-metadata/platform-ref-aws.configurations.meta.pkg.crossplane.io_v1alpha1.yaml"
    type: Patch

  - exec:
      command: sh
      args:
        - "-c"
        - "'up xpkg build --name test-smaller-provider-migration.xpkg --package-root=package --examples-root=examples'"
    name: build-configuration
    manualExecution:
      - "sh -c 'up xpkg build --name test-smaller-provider-migration.xpkg --package-root=package --examples-root=examples'"
    type: Exec

  - exec:
      command: sh
      args:
        - "-c"
        - "'up xpkg push ${ORG}/${PLATFORM}:${TAG} -f package/test-smaller-provider-migration.xpkg'"
    name: push-configuration
    manualExecution:
      - "sh -c 'up xpkg push ${ORG}/${PLATFORM}:${TAG} -f package/test-smaller-provider-migration.xpkg'"
    type: Exec

version: 0.1.0
